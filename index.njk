---
title: Ergophobia
pagination:
  data: collections.posts
  size: 6
  alias: posts
permalink: "{% if pagination.pageNumber > 0 %}page/{{ pagination.pageNumber + 1 }}/{% endif %}index.html"
---
{% extends "layout.njk" %}

{% block content %}

  <section id="posts-list" style="margin-top: 1.5rem;">

    {% for post in posts %}
      <article class="post-card">

        <!-- Top metadata bar with title, date/time, and copy button -->
        <div class="metadata-section" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0.75rem 0.5rem 0.75rem; margin: 0; gap: 0.75rem;">
          <!-- Title (left-aligned, truncated if needed) -->
          <div class="post-title-wrapper" style="flex: 1; min-width: 0; overflow: hidden; position: relative;">
            {% if post.data.title %}
              <h2 class="post-title" 
                  style="font-size: 1.125rem; font-weight: 600; margin: 0; line-height: 1.4; letter-spacing: -0.01em;"
                  data-full-title="{{ post.data.title }}">
                <a href="{{ post.url }}" style="display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ post.data.title }}</a>
              </h2>
              <div class="title-tooltip" style="display: none; opacity: 0; visibility: hidden;">{{ post.data.title }}</div>
            {% endif %}
          </div>

          <!-- Date/time and copy button (right-aligned) -->
          <div style="display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0;">
            <a href="{{ post.url }}" class="date-link" style="text-decoration: none; color: inherit;">
              <time datetime="{{ post.date | formatDate('yyyy-MM-dd') }}" 
                    style="font-size: 0.75rem; color: #666; white-space: nowrap; cursor: pointer; transition: color 0.15s ease;">
                {{ post.date | formatDate("MMM d, yyyy 'at' h:mm a") }}
              </time>
            </a>

            <!-- Fixed share button -->
            <button class="share-btn"
                    style="padding: 0.375rem; border-radius: 0.5rem; border: none; background: transparent; cursor: pointer; transition: all 0.15s ease; flex-shrink: 0; position: relative;"
                    data-url="{{ post.url | absoluteUrl(site.url) }}"
                    aria-label="Copy post link">
              <svg class="share-icon" style="width: 1rem; height: 1rem; color: #666; display: block;"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   stroke-linecap="round"
                   stroke-linejoin="round"
                   aria-hidden="true">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <svg class="checkmark-icon" style="width: 1rem; height: 1rem; color: var(--accent); display: none;"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="3"
                   stroke-linecap="round"
                   stroke-linejoin="round"
                   aria-hidden="true">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span class="copy-tooltip">Copied!</span>
            </button>
          </div>
        </div>

        {% set videoUrl = post.data.videoUrl or post.data.youtubeUrl %}
        {% set isVideoPost = post.data.layout == "video.njk" or post.data.layout == "youtube.njk" or videoUrl %}
        
        {% if isVideoPost %}
          <!-- Video post: embed with padding -->
          <div class="video-post-container">
            {% if videoUrl %}
              {% set platform = videoUrl | detectVideoPlatform %}
              {% if platform == "youtube" %}
                {% set videoId = videoUrl | extractYoutubeId %}
                {% if videoId %}
                  <div class="video-embed-container-card">
                    <iframe 
                      src="https://www.youtube.com/embed/{{ videoId }}"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen
                      class="video-embed-card">
                    </iframe>
                  </div>
                {% else %}
                  <p class="video-error" style="font-size: 0.875rem; margin: 0 0.75rem 0.5rem 0.75rem; padding: 0.5rem;">Invalid YouTube URL: {{ videoUrl }}</p>
                {% endif %}
              {% elif platform == "vimeo" %}
                {% set videoId = videoUrl | extractVimeoId %}
                {% if videoId %}
                  <div class="video-embed-container-card">
                    <iframe 
                      src="https://player.vimeo.com/video/{{ videoId }}"
                      frameborder="0"
                      allow="autoplay; fullscreen; picture-in-picture"
                      allowfullscreen
                      class="video-embed-card">
                    </iframe>
                  </div>
                {% else %}
                  <p class="video-error" style="font-size: 0.875rem; margin: 0 0.75rem 0.5rem 0.75rem; padding: 0.5rem;">Invalid Vimeo URL: {{ videoUrl }}</p>
                {% endif %}
              {% elif platform == "direct" %}
                {% set posterUrl = post.data.posterUrl %}
                {% set videoPoster = videoUrl | getVideoPoster(posterUrl) %}
                <div class="video-embed-container-card">
                  <video controls {% if videoPoster %}poster="{{ videoPoster }}"{% endif %} class="video-embed-card">
                    <source src="{{ videoUrl }}" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>
                </div>
              {% else %}
                <p class="video-error" style="font-size: 0.875rem; margin: 0 0.75rem 0.5rem 0.75rem; padding: 0.5rem;">Unsupported video URL format: {{ videoUrl }}</p>
              {% endif %}
            {% endif %}
          </div>
        {% endif %}

        <div style="padding: {% if isVideoPost %}0{% else %}0{% endif %} 0.75rem 0.75rem 0.75rem;">

          <!-- Content logic -->
          <div class="prose" style="max-width: none; font-size: 15px; line-height: 1.5;">
            {% if isVideoPost %}
              <!-- Video post description -->
              {% if post.templateContent and post.templateContent | trim %}
                <div class="video-description-card">
                  {{ post.templateContent | safe }}
                </div>
              {% endif %}
            {% elif loop.index0 == 0 %}
              <!-- Most recent post: always show full content -->
              {{ post.templateContent | safe }}
            {% elif post | needsExpand %}
              <!-- Long post: show first 2 paragraphs + expand button -->
              <div class="excerpt-content">
                {{ post | firstTwoParagraphs | safe }}
              </div>

              <div style="margin-top: 0.5rem;">
                <button class="read-more"
                        data-action="expand"
                        aria-expanded="false"
                        aria-label="Show full post">
                  Show more
                </button>
              </div>

              <!-- Hidden full content -->
              <div class="full-content hidden mt-4">
                {{ post.templateContent | safe }}
              </div>
            {% else %}
              <!-- Short post: show full content directly -->
              {{ post.templateContent | safe }}
            {% endif %}
          </div>

        </div>

      </article>
    {% endfor %}

  </section>

  <!-- JavaScript -->
  <script>
    // Function to attach expand listeners
    function attachExpandListeners() {
      document.querySelectorAll('.read-more[data-action="expand"]').forEach(btn => {
        // Skip if already has listener
        if (btn.dataset.expandListenerAttached) return;
        btn.dataset.expandListenerAttached = 'true';
        
        btn.addEventListener('click', function() {
          const article = this.closest('.post-card');
          const excerpt = article.querySelector('.excerpt-content');
          const full = article.querySelector('.full-content');
          const moreBtn = this.closest('div');

          if (excerpt) excerpt.style.display = 'none';
          if (moreBtn) moreBtn.style.display = 'none';
          if (full) {
            // Remove hidden class and show content
            full.classList.remove('hidden');
            full.style.display = 'block';
            // Trigger animation by forcing reflow
            full.offsetHeight;
          }

          // Update accessibility attributes
          this.setAttribute('aria-expanded', 'true');
          this.setAttribute('aria-label', 'Post expanded');
        });
      });
    }

    // Function to attach share button listeners
    function attachShareListeners() {
      document.querySelectorAll('.share-btn').forEach(btn => {
        // Skip if already has listener
        if (btn.dataset.shareListenerAttached) return;
        btn.dataset.shareListenerAttached = 'true';
        
        btn.addEventListener('click', async function() {
          const url = this.getAttribute('data-url');
          const shareIcon = this.querySelector('.share-icon');
          const checkmarkIcon = this.querySelector('.checkmark-icon');
          const tooltip = this.querySelector('.copy-tooltip');
          
          try {
            await navigator.clipboard.writeText(url);

            // Switch to checkmark icon
            if (shareIcon) shareIcon.style.display = 'none';
            if (checkmarkIcon) checkmarkIcon.style.display = 'block';
            
            // Show tooltip
            if (tooltip) {
              tooltip.style.opacity = '1';
              tooltip.style.visibility = 'visible';
            }

            // Reset after 2 seconds
            setTimeout(() => {
              if (shareIcon) shareIcon.style.display = 'block';
              if (checkmarkIcon) checkmarkIcon.style.display = 'none';
              if (tooltip) {
                tooltip.style.opacity = '0';
                tooltip.style.visibility = 'hidden';
              }
            }, 2000);

          } catch (err) {
            console.error('Copy failed', err);
            prompt('Copy failed â€” copy manually:', url);
          }
        });
      });
    }

    // Function to check if title is truncated and enable tooltip
    function checkTitleTruncation() {
      document.querySelectorAll('.post-title').forEach(titleEl => {
        const titleLink = titleEl.querySelector('a');
        const titleWrapper = titleEl.parentElement;
        const tooltip = titleWrapper.querySelector('.title-tooltip');
        
        if (titleLink && tooltip) {
          // Skip if already has listener
          if (titleWrapper.dataset.tooltipListenerAttached) {
            // Recheck truncation status
            const isTruncated = titleLink.scrollWidth > titleLink.offsetWidth;
            if (isTruncated) {
              tooltip.style.display = 'block';
            } else {
              tooltip.style.display = 'none';
            }
            return;
          }
          
          // Check if text is truncated
          // Use a small delay to ensure DOM is fully rendered
          setTimeout(() => {
            const isTruncated = titleLink.scrollWidth > titleLink.offsetWidth;
            
            if (isTruncated) {
              titleEl.classList.add('is-truncated');
              tooltip.style.display = 'block';
              tooltip.style.opacity = '0';
              tooltip.style.visibility = 'hidden';
              
              // Mark as having listener attached
              titleWrapper.dataset.tooltipListenerAttached = 'true';
              
              // Show tooltip on hover using JavaScript (like copy tooltip)
              titleWrapper.addEventListener('mouseenter', function() {
                const tip = this.querySelector('.title-tooltip');
                if (tip && tip.style.display !== 'none') {
                  tip.style.opacity = '1';
                  tip.style.visibility = 'visible';
                }
              });
              
              titleWrapper.addEventListener('mouseleave', function() {
                const tip = this.querySelector('.title-tooltip');
                if (tip) {
                  tip.style.opacity = '0';
                  tip.style.visibility = 'hidden';
                }
              });
            } else {
              titleEl.classList.remove('is-truncated');
              tooltip.style.display = 'none';
            }
          }, 100);
        }
      });
    }

    // Initialize listeners on page load
    attachExpandListeners();
    attachShareListeners();
    
    // Check title truncation after page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', checkTitleTruncation);
    } else {
      checkTitleTruncation();
    }
    
    // Recheck on window resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(checkTitleTruncation, 100);
    });

    // Infinite scroll
    let currentPage = 1;
    let loading = false;
    let hasMore = true;

    function loadMorePosts() {
      if (loading || !hasMore) return;
      loading = true;
      currentPage++;
      const nextUrl = `/page/${currentPage}/`;
      fetch(nextUrl)
        .then(response => {
          if (!response.ok) {
            if (response.status === 404) hasMore = false;
            throw new Error('Network response not ok');
          }
          return response.text();
        })
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const newPosts = doc.querySelector('#posts-list')?.innerHTML;
          if (newPosts && newPosts.trim()) {
            document.querySelector('#posts-list').insertAdjacentHTML('beforeend', newPosts);
            // Reattach event listeners for newly loaded posts
            attachExpandListeners();
            attachShareListeners();
            // Check title truncation for new posts
            checkTitleTruncation();
          } else {
            hasMore = false;
          }
          loading = false;
        })
        .catch(error => {
          console.error('Error loading more posts:', error);
          loading = false;
        });
    }

    window.addEventListener('scroll', () => {
      const scrollPos = window.innerHeight + window.scrollY;
      const pageHeight = document.documentElement.scrollHeight;
      if (scrollPos >= pageHeight - 300) {
        loadMorePosts();
      }
    });
  </script>

{% endblock %}
